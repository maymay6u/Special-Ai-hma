<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voc -üîÆ - AI Enhanced</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 30px;
      text-align: center;
    }
    input, button {
      font-size: 20px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      margin: 10px;
    }
    input {
      width: 100px;
      text-align: center;
    }
    button {
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      font-size: 24px;
      color: #00ff99;
    }
    .led {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin: 10px;
    }
    .led.green { background-color: green; }
    .led.red { background-color: red; }
    #chartBox {
      width: 80%;
      margin: auto;
      background: #222;
      padding: 20px;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <h1>CK Smart Predictor üîÆ</h1>
  <p>·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·Ä≤·Ä∑·Äû·Ä±·Ä¨·ÄÇ·Äè·Äî·Ä∫·Ä∏ ·ÅÅ ·Äú·ÄØ·Ä∂·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´</p>
  <input type="number" id="inputNum" min="0" max="9" placeholder="e.g. 4">
  <button onclick="predict()">·ÄÅ·Äî·Ä∑·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·Äï·Ä´</button>
  <button onclick="resetData()">‚ôªÔ∏è Reset</button>
  <div class="result" id="result"></div>
  <div id="statusBox">
    <div class="led" id="statusLed"></div>
    <strong>Powered by HtetMyat</strong>
  </div>
  <div id="chartBox">
    <canvas id="freqChart"></canvas>
  </div>

  <script>
    let history = JSON.parse(localStorage.getItem('lotto_history')) || [5, 2, 4, 7, 1];
    const statusLed = document.getElementById("statusLed");

    function updateLocalStorage() {
      localStorage.setItem('lotto_history', JSON.stringify(history));
    }

    function resetData() {
      history = [];
      updateLocalStorage();
      document.getElementById("result").innerText = "";
      updateChart();
      statusLed.className = "led";
    }

    function detectLogicSwitch(history) {
      if (history.length < 4) return false;
      const last3 = history.slice(-3);
      const bigs = last3.filter(n => n >= 5).length;
      const smalls = last3.filter(n => n <= 4).length;
      return (bigs === 0 || smalls === 0); // Sudden shift
    }

    function fallbackSafePredict(history, freq) {
      let preferSmall = history.slice(-5).filter(n => n <= 4).length > 2;
      return getLeastUsed(freq, preferSmall ? 0 : 5, preferSmall ? 4 : 9);
    }

    function enhancedPredict(input, history) {
      const freq = Array(10).fill(0);
      history.forEach(n => freq[n]++);

      let prev1 = history[history.length - 1];
      let prev2 = history[history.length - 2] || prev1;
      let zigzag = (prev1 > prev2) ? input - 1 : input + 1;
      zigzag = Math.max(0, Math.min(9, zigzag));

      let repeatAvoid = (prev1 === prev2) ? (input + 2) % 10 : input;

      let smallCount = history.slice(-5).filter(n => n <= 4).length;
      let bigCount = 5 - smallCount;
      let preferGroup = smallCount > bigCount ? 'big' : 'small';
      let groupPick = getLeastUsed(freq, preferGroup === 'big' ? 5 : 0, preferGroup === 'big' ? 9 : 4);

      let rare = freq.indexOf(Math.min(...freq));
      let fallback = fallbackSafePredict(history, freq);

      let candidates = [zigzag, repeatAvoid, groupPick, rare];

      if (detectLogicSwitch(history)) {
        console.warn("‚ö†Ô∏è Logic switch detected. Using fallback prediction.");
        candidates = [fallback, rare];
      }

      return mode(candidates);
    }

    function predict() {
      const input = parseInt(document.getElementById("inputNum").value);
      if (isNaN(input) || input < 0 || input > 9) {
        alert("0 ·ÄÄ·Äî·Ä± 9 ·Äë·Ä≤·ÄÄ ·ÄÇ·Äè·Äî·Ä∫·Ä∏·Äê·ÄÖ·Ä∫·Äú·ÄØ·Ä∂·Ä∏·Äû·Ä¨·Äë·Ää·Ä∑·Ä∫·Äï·Ä´");
        return;
      }

      const final = enhancedPredict(input, history);

      history.push(final);
      updateLocalStorage();

      const correct = (input === final);
      statusLed.className = "led " + (correct ? "green" : "red");
      document.getElementById("result").innerText =
        `üìç ·ÄÅ·Äî·Ä∑·Ä∫·Äô·Äæ·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫: ${final} (${correct ? '‚úîÔ∏è ·Äô·Äæ·Äî·Ä∫' : '‚ùå ·Äô·Äô·Äæ·Äî·Ä∫'})`;
      updateChart();
    }

    function mode(arr) {
      return arr.sort((a, b) =>
        arr.filter(v => v === a).length - arr.filter(v => v === b).length
      ).pop();
    }

    function getLeastUsed(freq, min, max) {
      let minFreq = Math.min(...freq.slice(min, max + 1));
      for (let i = min; i <= max; i++) {
        if (freq[i] === minFreq) return i;
      }
      return min;
    }

    function updateChart() {
      const ctx = document.getElementById('freqChart').getContext('2d');
      const data = {
        labels: [...Array(10).keys()],
        datasets: [{
          label: 'Frequency (%)',
          data: Array(10).fill(0).map((_, i) => {
            const count = history.filter(x => x === i).length;
            return ((count / history.length) * 100).toFixed(1);
          }),
          backgroundColor: '#00ff99'
        }]
      };

      if (window.chartObj) window.chartObj.destroy();
      window.chartObj = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          scales: {
            y: { beginAtZero: true, max: 100 }
          }
        }
      });
    }

    updateChart();
  </script>
</body>
</html>
